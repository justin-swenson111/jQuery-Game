<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suffering</title>
    <link rel="stylesheet" href="styles/css/styles.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <link rel="shortcut icon" href="media/favicon-16x16.png" type="image/x-icon">
</head>
<body>
    <section>
        <h1>Picker Matcher</h1>
        <h1 class="score">Score: 0</h1>
        <h2>High Score: 0</h2>
        <section class="grid">
            <div class="row">
                <button class="" id="1"><img src="" alt=""></button>
                <button class="" id="2"><img src="" alt=""></button>
                <button class="" id="3"><img src="" alt=""></button>
                <button class="" id="4"><img src="" alt=""></button>
                <button class="" id="5"><img src="" alt=""></button>
                <button class="" id="6"><img src="" alt=""></button>
            </div>
            <div class="row">
                <button class="" id="7"><img src="" alt=""></button>
                <button class="" id="8"><img src="" alt=""></button>
                <button class="" id="9"><img src="" alt=""></button>
                <button class="" id="10"><img src="" alt=""></button>
                <button class="" id="11"><img src="" alt=""></button>
                <button class="" id="12"><img src="" alt=""></button>
            </div>
            <div class="row">
                <button class="" id="13"><img src="" alt=""></button>
                <button class="" id="14"><img src="" alt=""></button>
                <button class="" id="15"><img src="" alt=""></button>
                <button class="" id="16"><img src="" alt=""></button>
                <button class="" id="17"><img src="" alt=""></button>
                <button class="" id="18"><img src="" alt=""></button>
            </div>
            <div class="row">
                <button class="" id="19"><img src="" alt=""></button>
                <button class="" id="20"><img src="" alt=""></button>
                <button class="" id="21"><img src="" alt=""></button>
                <button class="" id="22"><img src="" alt=""></button>
                <button class="" id="23"><img src="" alt=""></button>
                <button class="" id="24"><img src="" alt=""></button>
            </div>
            <div class="row">
                <button class="" id="25"><img src="" alt=""></button>
                <button class="" id="26"><img src="" alt=""></button>
                <button class="" id="27"><img src="" alt=""></button>
                <button class="" id="28"><img src="" alt=""></button>
                <button class="" id="29"><img src="" alt=""></button>
                <button class="" id="30"><img src="" alt=""></button>
            </div>
            <div class="row">
                <button class="" id="31"><img src="" alt=""></button>
                <button class="" id="32"><img src="" alt=""></button>
                <button class="" id="33"><img src="" alt=""></button>
                <button class="" id="34"><img src="" alt=""></button>
                <button class="" id="35"><img src="" alt=""></button>
                <button class="" id="36"><img src="" alt=""></button>
            </div>
            <button id="shuffle">shuffle</button>
            <button id="start">restart</button>
        </section>
        <section id="group">

        </section>
        <div id="audio">

        </div>
    </section>
    <script>
        $(document).ready(function() {
    // Define the types of cards
    // The card Types
    const types = {
        "lebron": {
            "name": "Lebron James",
            "class": 'lebron',
            "frequency": 0,
            "image": "https://i.etsystatic.com/51516337/r/il/20e70c/6287083849/il_fullxfull.6287083849_1fov.jpg",
            "won": false,
            "sound": "./media/audio/lebron.mp3"
        },
        "lyndon": {
            "name": "Lyndon B. Johnson",
            "class": "lyndon",
            "frequency": 0,
            "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/37_Lyndon_Johnson_3x4.jpg/800px-37_Lyndon_Johnson_3x4.jpg",
            "won": false,
            "sound": "./media/audio/lyndon.mp3"
        },
        "pikachu": {
            "name": "Pikachu",
            "class": "pikachu",
            "frequency": 0,
            "image": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQhUI3o0VQxnb0mx2apfVxPL4_3kujpXRThdA&s",
            "won": false,
            "sound": "./media/audio/pikachu.mp3"
        },
        "cartmen": {
            "name": "Eric Cartmen",
            "class": "cartmen",
            "frequency": 0,
            "image": "https://i.scdn.co/image/ab67616d0000b2733be777fd4bb1f5825d161920",
            "won": false,
            "sound": "./media/audio/cartman.mp3"
        },
        "dafoe": {
            "name": "dafoe",
            "class": "dafoe",
            "frequency": 0,
            "image": "https://m.media-amazon.com/images/I/71Q4Whw5ScL._AC_UF894,1000_QL80_.jpg",
            "won": false,
            "sound": "./media/audio/dafoe.mp3"
        },
        "justice": {
            "name": "justice",
            "class": "justice",
            "frequency": 0,
            "image": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRLX58_Xv8y2HLnmTFvXymOCqOb3SPLJY4iwg&s",
            "won": false,
            "sound": "./media/audio/justice.mp3"
        },
        "vincing": {
            "name": "vincig",
            "class": "vincing",
            "frequency": 0,
            "image": "https://www.cnet.com/a/img/resize/51d2a0767ae12b02ae498c4f4c6e5dc2f491f546/hub/2025/02/03/cfb7118f-bc7d-442d-97ed-128640f00eb3/invincible-s3-blue-suit.jpg?auto=webp&fit=crop&height=1200&width=1200",
            "won": false,
            "sound": "./media/audio/vincing.mp3"
        },
        "poweranger": {
            "name": "Poweranger",
            "class": "poweranger",
            "frequency": 0,
            "image": "https://cdnb.artstation.com/p/assets/images/images/057/743/851/large/iconic-design-studio-luca-nemolato-redranger-v2-34-stage1.jpg?1672536401",
            "won": false,
            "sound": "./media/audio/powerRanger.mp3"
        },
        "windmill": {
            "name": "Windmill",
            "class": "windmill",
            "frequency": 0,
            "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/7/79/GGParkNorthWindmill2.jpg/1200px-GGParkNorthWindmill2.jpg",
            "won": false,
            "sound": "./media/audio/wind.mp3"
        },
        "battery": {
            "name": "Battery",
            "class": "battery",
            "frequency": 0,
            "image": "https://webobjects2.cdw.com/is/image/CDW/5499085?$product-main$",
            "won": false,
            "sound": "./media/audio/battery.mp3"
        },
        "spider": {
            "name": "Spider",
            "class": "spider",
            "frequency": 0,
            "image": "https://preview.redd.it/ultimate-spider-man-fanart-v0-i2ilmk0dvaid1.jpeg?width=640&crop=smart&auto=webp&s=bf698915e91246555991268d1522286ba337c772",
            "won": false,
            "sound": "./media/audio/spider.mp3"
        },
        "cowboy": {
            "name": "Cowboy Hat",
            "class": "cowboy",
            "frequency": 0,
            "image": "https://shop.opry.com/cdn/shop/files/2794bl_1080x_4a4ac796-feec-445c-87e4-97499a38a465.jpg?v=1695822324",
            "won": false,
            "sound": "./media/audio/cowboy.mp3"
        },
        "batman": {
            "name": "Batman",
            "class": "batman",
            "frequency": 0,
            "image": "https://mediaproxy.tvtropes.org/width/1200/https://static.tvtropes.org/pmwiki/pub/images/batman_91.png",
            "won": false,
            "sound": "./media/audio/batman.mp3"
        },
        "apple": {
            "name": "Apple",
            "class": "apple",
            "frequency": 0,
            "image": "https://i.pinimg.com/564x/b1/f1/70/b1f170bfba5817dd84429e5b5ebbcc85.jpg",
            "won": false,
            "sound": "./media/audio/apple.mp3"
        },
        "basketball": {
            "name": "Basketball",
            "class": "basketball",
            "frequency": 0,
            "image": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRuu6ehEG7zcMmQhCYkrqBPNqxnGwYxJne3DA&s",
            "won": false,
            "sound": "./media/audio/ball.mp3"
        },
        "galvanized": {
            "name": "Galvanized Square Steel",
            "class": "galvanized",
            "frequency": 0,
            "image": "https://preview.redd.it/i-love-the-new-galvanized-mod-v0-k06r00pstr1d1.png?auto=webp&s=1c56d5cf9c4471f68a724b366aa59149f79da9d7",
            "won": false,
            "sound": "./media/audio/galvanized.mp3"
        },
        "dollar": {
            "name": "Dollar Bill",
            "class": "dollar",
            "frequency": 0,
            "image": "https://images.squarespace-cdn.com/content/v1/51dc0f2ae4b08fbe8d2c8523/1373652422804-0HUPD1WWEUBN2AZFP9SU/MW_CP_LINCOLNA.jpg?format=2500w",
            "won": false,
            "sound": "./media/audio/dollar.mp3"
        },
        "boom": {
            "name": "Boom Box",
            "class": "boom",
            "frequency": 0,
            "image": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSraSnFEN8iOwUeqie8lCntPwtWnWcMTkwk6g&s",
            "won": false,
            "sound": "./media/audio/boom.mp3"
        }
    };

    // Initialize game variables
    let count = 36;
    let selected = [];
    let current = "";
    let group = [];
    let num = 0;
    let attempts = 0;
    let score = 0;
    let highscore = 0;
    let gameStarted = false;
    let canClick = false;  // Initially prevent clicking until cards are shown and hidden

    // Retrieve high score from local storage
    if (localStorage.getItem("highscore") == null) {
        localStorage.setItem("highscore", 0);
    }
    highscore = localStorage.getItem("highscore");
    changeScore();

    // Function to update the score display
    function changeScore() {
        $(".score").text(`Score: ${score}`);
        if (score > highscore) {
            highscore = score;
            localStorage.setItem("highscore", highscore);
        }
        $("h2").text(`High Score: ${highscore}`);
    }

    // Function to show countdown timer
    function showCountdown(seconds) {
        // Create countdown element if it doesn't exist
        if ($("#countdown").length === 0) {
            $("body").append('<div id="countdown" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 5rem; color: #f00; z-index: 1000;"></div>');
        }
        
        $("#countdown").text(seconds);
        
        if (seconds > 0) {
            setTimeout(() => showCountdown(seconds - 1), 1000);
        } else {
            $("#countdown").remove();
            // Hide cards after countdown
            for (let i = 1; i <= 36; i++) {
                if (!cardIsWon(i)) {
                    $(`#${i}`).children("img").animate({ "opacity": "0" }, 500);
                }
            }
            canClick = true; // Enable clicking after cards are hidden
        }
    }

    // Function to check if a card is already won
    function cardIsWon(cardId) {
        const cardClass = $(`#${cardId}`).attr("class");
        for (let i = 0; i < selected.length; i++) {
            if (cardClass.includes(selected[i].class) && selected[i].won) {
                return true;
            }
        }
        return false;
    }

    // Function to start the game
    function start() {
        // Reset variables
        selected = [];
        group = [];
        num = 0;
        attempts = 0;
        gameStarted = true;
        canClick = false;  // Disable clicking during reveal
        
        // Reset card classes and images
        for (let i = 1; i <= 36; i++) {
            const card = $(`#${i}`);
            // Remove all possible class types
            for (const key in types) {
                card.removeClass(types[key].class);
            }
            card.children("img").css("opacity", "0");
            card.children("img").removeClass("flip");
        }
        
        // Reset card types
        const keys = Object.keys(types);
        keys.forEach(key => {
            types[key].frequency = 0;
            types[key].won = false;
        });
        
        // Select random card types
        num = Math.floor(Math.random() * 18) + 1;
        while (selected.length < num) {
            const randomKey = keys[Math.floor(Math.random() * keys.length)];
            if (!selected.some(item => item.name === types[randomKey].name)) {
                selected.push(types[randomKey]);
            }
        }
        
        // Assign cards to the board
        for (let i = 1; i <= 36; i++) {
            let ran = Math.floor(Math.random() * selected.length);
            $(`#${i}`).children("img").attr("src", selected[ran].image);
            $(`#${i}`).addClass(selected[ran].class);
            selected[ran].frequency++;
        }
        
        // Remove card types with zero frequency
        for (let i = 0; i < selected.length; i++) {
            if (selected[i].frequency == 0) {
                selected.splice(i, 1);
                i--;
            }
        }
        
        // Show all cards for 3 seconds
        for (let i = 1; i <= 36; i++) {
            $(`#${i}`).children("img").css("opacity", "1");
        }
        
        // Start countdown
        showCountdown(3);
        
        // Update the group display
        updateGroupDisplay();
    }

    // Start the game initially
    start();

    // Function to shuffle the cards
    function shuffle() {
        let temp = [];
        for (let i = 0; i < selected.length; i++) {
            temp.push(selected[i].frequency);
        }
        
        for (let i = 1; i <= 36; i++) {
            while (true) {
                let ran = Math.floor(Math.random() * selected.length);
                if (temp[ran] > 0) {
                    // Remove all possible class types
                    for (let j = 0; j < selected.length; j++) {
                        $(`#${i}`).removeClass(selected[j].class);
                    }
                    $(`#${i}`).children("img").attr("src", selected[ran].image);
                    $(`#${i}`).addClass(selected[ran].class);
                    temp[ran]--;
                    break;
                }
            }
            found(i);
        }
        
        // Update the group display
        updateGroupDisplay();
    }

    // Function to handle found cards
    function found(i) {
        for (let j = 0; j < selected.length; j++) {
            if (selected[j].class == $(`#${i}`).attr("class")) {
                if (selected[j].won == true) {
                    $(`#${i}`).children("img").animate({ "opacity": "1" }, 1000);
                } else {
                    $(`#${i}`).children("img").animate({ "opacity": "0" }, 1000);
                }
            }
        }
    }

    // Function to update group display - only show frequencies for non-matched types
    function updateGroupDisplay() {
        $("#group").empty();
        for (let i = 0; i < selected.length; i++) {
            // Only display frequency for types that haven't been fully matched
            if (!selected[i].won) {
                $("#group").append(`<p>card type frequency: ${selected[i].frequency}</p>`);
            }
        }
    }

    // Function to play sound with reliable reset
    function sound(src) {
        console.log("play");
        
        // Clear any existing timeout to prevent conflicts
        if (window.soundTimeout) {
            clearTimeout(window.soundTimeout);
        }
        
        if (window.currentAudio) {
            window.currentAudio.pause();
            window.currentAudio.currentTime = 0;
            window.currentAudio = null;
        }
        
        window.currentAudio = new Audio(src);
        window.currentAudio.onerror = function() {
            console.error("Error playing audio:", src);
        };
        
        // Play the audio
        const playPromise = window.currentAudio.play();
        
        // Handle play promise (required for some browsers)
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                console.error("Playback failed:", error);
            });
        }
        
        // Set timeout to stop the audio
        window.soundTimeout = setTimeout(function() {
            if (window.currentAudio) {
                window.currentAudio.pause();
                window.currentAudio.currentTime = 0;
                console.log("stop");
            }
        }, 100000);
    }

    // Function to handle incorrect attempts
    function gitgud() {
        attempts = 0;
        let rand = Math.floor(Math.random() * 5) + 1;
        let inp;
        do {
            inp = prompt("guess a number one through five");
        } while (isNaN(inp));
        if (inp != rand) {
            alert("WRONG!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
            shuffle();
        }
    }

    // Function to check if all matches are found
    function checkAllMatched() {
        let allMatched = true;
        for (let i = 0; i < selected.length; i++) {
            if (!selected[i].won) {
                allMatched = false;
                break;
            }
        }
        return allMatched;
    }

    // Handle button clicks
    $("button").on("click", function() {
        // Don't process clicks on the shuffle or start buttons
        if ($(this).attr("id") === "shuffle" || $(this).attr("id") === "start") {
            return;
        }
        
        // Ignore clicks until the initial reveal is complete
        if (!canClick) return;
        
        // Temporarily disable clicking to prevent rapid clicks
        canClick = false;
        setTimeout(() => canClick = true, 300);

        $(this).children("img").addClass("flip");
        $(this).children("img").animate({ "opacity": "1" }, 1000);

        if (group.length == 0) {
            num = 0;
        }
        group.push($(this).attr("id"));
        let soundPlayed = false;
        
        if ($(this).attr("class").includes($(`#${group[0]}`).attr("class"))) {
            console.log("match");
            num++;
            
            // Check which card type was matched
            for (let i = 0; i < selected.length; i++) {
                if ($(this).hasClass(selected[i].class)) {
                    if (num == selected[i].frequency) {
                        console.log("win");
                        if (!selected[i].won) {
                            selected[i].won = true;
                            score += Math.floor(Math.random() * 100) + 1;
                            changeScore();
                            sound(selected[i].sound);
                            
                            // Immediately update group display when a type is fully matched
                            updateGroupDisplay();
                        }
                        group = [];
                        num = 0;
                    }
                }
            }
        } else {
            for (let i = 0; i < group.length; i++) {
                $(`#${group[i]}`).children("img").removeClass("flip");
                // Only hide cards that aren't part of a won set
                if (!cardIsWon(group[i])) {
                    $(`#${group[i]}`).children("img").animate({ "opacity": "0" }, 1000);
                }
            }
            group = [];
            console.log("no match");
            num = 0;
            attempts++;
            if (attempts == 5) {
                gitgud();
            }
        }

        // Play sound for the card type
        for (let i = 0; i < selected.length; i++) {
            for (let j = 0; j < group.length; j++) {
                if ($(`#${group[j]}`).hasClass(selected[i].class) && !soundPlayed) {
                    sound(selected[i].sound);
                    soundPlayed = true;
                    break;
                }
            }
            if (soundPlayed) break;
        }

        // Check if all cards are matched
        if (checkAllMatched()) {
            setTimeout(function() {
                const playAgain = confirm("You Win! Do you want to play again?");
                if (playAgain) {
                    score = 0;
                    changeScore();
                    start();
                    shuffle();
                }
            }, 1000);
        }
    });

    // Shuffle cards initially
    shuffle();
    console.log(selected);

    // Handle shuffle button click
    $("#shuffle").on("click", function() {
        shuffle();
    });

    // Handle restart button click
    $("#start").on("click", function() {
        score = 0;
        changeScore();
        start();
        shuffle();
    });
});
    </script>
</body>
</html>